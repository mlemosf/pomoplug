{% block content %}
<style>
    #my_modal_1::backdrop {
        background: rgba(15, 23, 42, 0.65);
        backdrop-filter: blur(6px);
    }
</style>

<dialog
    id="my_modal_1"
    class="w-full max-w-sm rounded-2xl border border-slate-800 bg-slate-950 p-6 text-center shadow-2xl"
>
    <div class="space-y-4">
        <div class="flex items-center justify-center gap-3 text-amber-300">
            <span
                class="flex h-9 w-9 items-center justify-center rounded-full bg-amber-400/10"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="h-5 w-5"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M12 9v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                    />
                </svg>
            </span>
            <h3
                id="timer-title"
                class="text-lg font-semibold text-slate-100"
            ></h3>
        </div>
        <p class="text-sm text-slate-400">
            Essa ação apagará o timer definitivamente. Você tem certeza?
        </p>
        <div class="grid grid-cols-1 gap-3 sm:grid-cols-2">
            <button
                id="remove-button"
                type="button"
                class="inline-flex items-center justify-center rounded-xl bg-red-500 px-4 py-2 text-sm font-semibold text-white transition hover:bg-red-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-300"
                onclick="deleteTimer(this)"
            >
                Sim, remover
            </button>
            <button
                type="button"
                class="inline-flex items-center justify-center rounded-xl border border-slate-700 bg-slate-900 px-4 py-2 text-sm font-semibold text-slate-100 transition hover:border-amber-400 hover:text-amber-300 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-amber-200"
                onclick="my_modal_1.close()"
            >
                Cancelar
            </button>
        </div>
    </div>
</dialog>

<aside
    class="sidenav fixed inset-y-0 left-0 flex w-64 flex-col border-r border-slate-900 bg-slate-950/95 backdrop-blur"
>
    <div class="flex items-center justify-between px-8 py-6">
        <div>
            <h1 class="text-xl font-bold text-slate-100">Timers</h1>
        </div>
        <span
            class="flex h-10 w-10 items-center justify-center rounded-full border border-slate-800 bg-slate-900 text-amber-300"
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
            >
                <path d="M12 6v6l3 3" />
                <circle cx="12" cy="12" r="9" />
            </svg>
        </span>
    </div>

    <div class="flex-1 overflow-y-auto px-4 pb-8">
        <ul class="space-y-2">
            {% for item in timer_list %} {% if item.id == uuid %}
            <li>
                <div
                    class="group flex items-center justify-between rounded-xl border border-amber-400/40 bg-amber-400/10 px-4 py-2 text-sm font-semibold text-amber-200 shadow-sm"
                    aria-current="page"
                >
                    <div class="flex items-center gap-3">
                        <span
                            class="flex h-8 w-8 items-center justify-center rounded-lg bg-amber-400/20 text-amber-300"
                        >
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                class="h-4 w-4"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="1.5"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                            >
                                <path d="M12 6v6l3 3" />
                                <circle cx="12" cy="12" r="9" />
                            </svg>
                        </span>
                        <span class="w-28 truncate">{{ item.title }}</span>
                    </div>
                </div>
            </li>
            {% else %}
            <li>
                <div
                    class="group flex items-center justify-between rounded-xl border border-transparent px-4 py-2 transition hover:border-amber-400/40 hover:bg-slate-900/60"
                >
                    <a
                        class="flex flex-1 items-center gap-3 text-sm font-medium text-slate-200 transition group-hover:text-amber-200"
                        href="{% url 'timer-view' uuid=item.id %}"
                    >
                        <span
                            class="flex h-8 w-8 items-center justify-center rounded-lg bg-slate-900 text-amber-300 transition group-hover:bg-amber-400/20"
                        >
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                class="h-4 w-4"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="1.5"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                            >
                                <path d="M12 6v6l3 3" />
                                <circle cx="12" cy="12" r="9" />
                            </svg>
                        </span>
                        <span class="w-28 truncate">{{ item.title }}</span>
                    </a>
                    <button
                        type="button"
                        class="ml-3 inline-flex h-9 w-9 items-center justify-center rounded-full border border-transparent text-slate-500 transition hover:border-red-500/30 hover:bg-red-500/10 hover:text-red-400"
                        onclick="toggleDialogWithId('{{ item.id }}', '{{ item.title }}')"
                        aria-label="Remover timer {{ item.title }}"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-4 w-4"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="1.5"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                        >
                            <path d="M3 6h18" />
                            <path d="M8 6v12a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6" />
                            <path d="M10 6V4a2 2 0 0 1 2-2 2 2 0 0 1 2 2v2" />
                        </svg>
                    </button>
                </div>
            </li>
            {% endif %} {% empty %}
            <li>
                <div
                    class="rounded-xl border border-dashed border-slate-800 bg-slate-900/40 px-4 py-5 text-center"
                >
                    <p class="text-sm font-medium text-slate-400">
                        Nenhum timer encontrado. Crie um novo para começar.
                    </p>
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>

    <div class="border-t border-slate-900 px-6 py-5">
        <p class="text-xs text-slate-500">
            Acompanhe e sincronize seus ciclos de foco sem sair do fluxo.
        </p>
    </div>
</aside>

<script>
    (function () {
        const dialog = document.getElementById("my_modal_1");
        const removeButton = document.getElementById("remove-button");
        const timerTitle = document.getElementById("timer-title");

        if (!dialog || !removeButton) {
            return;
        }

        window.toggleDialogWithId = function (itemId, title) {
            removeButton.dataset.id = itemId;
            timerTitle.textContent = `Remover "${title}"?`;
            dialog.showModal();
        };

        window.deleteTimer = function (element) {
            const timerId = element?.dataset?.id;
            if (!timerId) {
                return;
            }

            fetch(`/timer/${timerId}`, {
                method: "DELETE",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": "{{ csrf_token }}",
                },
            })
                .then((response) => {
                    if (!response.ok) {
                        throw new Error("Não foi possível remover o timer.");
                    }
                    dialog.close();
                    if (typeof updateRemoteTimer === "function") {
                        updateRemoteTimer(currentStatus, timeLeft, true);
                    } else {
                        window.location.reload();
                    }
                })
                .catch((error) => {
                    console.error("Error:", error);
                });
        };
    })();
</script>
{% endblock %}
